apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  annotations:
    build.appstudio.openshift.io/repo: https://github.com:RedHatInsights/bonfire-tekton?rev={{revision}}
    build.appstudio.redhat.com/commit_sha: '{{revision}}'
    build.appstudio.redhat.com/pull_request_number: '{{pull_request_number}}'
    build.appstudio.redhat.com/target_branch: '{{target_branch}}'
    pipelinesascode.tekton.dev/max-keep-runs: "3"
    pipelinesascode.tekton.dev/on-cel-expression: event == "pull_request" && target_branch
      == "main" && files.all.exists(x, x.matches('.tekton/|pipelines/|tasks/'))
  labels:
    appstudio.openshift.io/application: bonfire-tekton
    appstudio.openshift.io/component: bonfire-tekton
  name: bonfire-tekton-on-pull-request
  namespace: rhtap-migration-tenant
spec:
  params:
  - name: URL
    value: '{{source_url}}'
  - name: REVISION
    value: '{{revision}}'
  - name: SNAPSHOT
    value: |
      {
        "application": "insights-ingress-go",
        "components": [
            {
                "name": "ingress",
                "containerImage": "quay.io/redhat-services-prod/hcc-integrations-tenant/insights-ingress-go:9661ab6af096c03578af00c52a1326462771ff4b@sha256:b6bdc5f356ba1fc6c58286274cef2b8639cb4434ec790abf99902f5088dcaefe",
                "source": {
                    "git": {
                        "url": "https://github.com/RedHatInsights/insights-ingress-go",
                        "revision": "9661ab6af096c03578af00c52a1326462771ff4b"
                    }
                }
            }
        ],
        "artifacts": {}
      }
  - name: APP_NAME
    value: ingress
  - name: COMPONENT_NAME
    value: ingress
  - name: IQE_PLUGINS
    value: ingress
  - name: IQE_MARKER_EXPRESSION
    value: smoke
  - name: IQE_FILTER_EXPRESSION
    value: "test_upload_post_success"
  - name: IQE_CJI_CLOWDAPP_NAME
    value: ingress
  - name: DEPLOY_TIMEOUT
    value: "950"
  pipelineRef:
      resolver: git
      params:
      - name: url
        value: '{{source_url}}'
      - name: revision
        value: '{{revision}}'
      - name: pathInRepo
        value: pipelines/basic.yaml

